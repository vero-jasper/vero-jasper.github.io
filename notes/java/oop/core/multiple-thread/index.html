<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.56">
<title data-react-helmet="true">多线程 | Welcome to Vero&#x27;s Website</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="多线程 | Welcome to Vero&#x27;s Website"><meta data-react-helmet="true" name="description" content="多线程"><meta data-react-helmet="true" property="og:description" content="多线程"><meta data-react-helmet="true" property="og:url" content="https://vero-jasper.github.io/notes/java/oop/core/multiple-thread"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://vero-jasper.github.io/notes/java/oop/core/multiple-thread"><link rel="stylesheet" href="/styles.cadbe1e8.css">
<link rel="preload" href="/styles.8856dc76.js" as="script">
<link rel="preload" href="/runtime~main.3d7433c3.js" as="script">
<link rel="preload" href="/main.358b5d49.js" as="script">
<link rel="preload" href="/1.2ebb2427.js" as="script">
<link rel="preload" href="/2.788804a9.js" as="script">
<link rel="preload" href="/4.ef71900f.js" as="script">
<link rel="preload" href="/1be78505.fcf222eb.js" as="script">
<link rel="preload" href="/54.005b5dfa.js" as="script">
<link rel="preload" href="/ec1ed54d.1373f991.js" as="script">
<link rel="preload" href="/3.e8253ddf.js" as="script">
<link rel="preload" href="/e98647ac.3303959e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top navbarHideable_OaSq"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">Vero&#x27;s Home</strong></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a activeclassname="navbar__link--active" class="navbar__item navbar__link">Notes</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/notes/java/base/intro">java</a></li><li><a class="dropdown__link" href="/notes/mysql/intro">mysql</a></li></ul></div><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">Vero&#x27;s Home</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a activeclassname="navbar__link--active" class="menu__link menu__link--sublist">Notes</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/notes/java/base/intro">java</a></li><li class="menu__list-item"><a class="menu__link" href="/notes/mysql/intro">mysql</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs sidebarWithHideableNavbar_1-U5"><a tabindex="-1" class="sidebarLogo_3ono" href="/"><img src="/img/logo.svg" alt="My Site Logo"><strong>Vero&#x27;s Home</strong></a><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Java笔记</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Java基础</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/notes/java/base/intro">Java简介</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/notes/java/base/firstProgram">编写第一个Java程序</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/notes/java/base/crossPlatform">跨平台原理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/notes/java/base/var">变量</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/notes/java/base/javaDataType">Java数据类型</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/notes/java/base/hex">进制转换</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/notes/java/base/mathematical">算术运算</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">流程控制</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/notes/java/process/control">流程控制</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">面向对象编程</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java/oop/intro">简介</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">面向对象基础</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/notes/java/oop/base/annotation">注解</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Java核心类</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java/oop/core/string">String类的概述和使用</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java/oop/core/varystring">可变字符串类</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java/oop/core/date">Date相关</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java/oop/core/collection-1">集合类库（一）</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java/oop/core/collection-2">集合类库（二）</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java/oop/core/exception">异常机制</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java/oop/core/file">File类</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java/oop/core/io">IO流</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/notes/java/oop/core/multiple-thread">多线程</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java/oop/core/network">网络编程</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/notes/java/oop/core/reflect">反射机制</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">设计模式</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/notes/java/project/design">设计原则和设计模式</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Java新特性</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/notes/java/new-feature">Java新特性</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Mysql</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/notes/mysql/intro">Mysql简介</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/notes/mysql/transaction">数据库事务</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/notes/mysql/design">MySQL多表&amp;外键&amp;数据库设计</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/notes/mysql/index">MySQL索引&amp;视图&amp;存储过程</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="多线程"></a>多线程<a aria-hidden="true" tabindex="-1" class="hash-link" href="#多线程" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="基本概念"></a>基本概念<a aria-hidden="true" tabindex="-1" class="hash-link" href="#基本概念" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="程序和进程"></a>程序和进程<a aria-hidden="true" tabindex="-1" class="hash-link" href="#程序和进程" title="Direct link to heading">#</a></h4><ul><li>程序：数据结构+算法，主要指存放在硬盘上的可执行文件</li><li>进程：主要指运行在内存中的可执行文件</li><li>目前主流的操作系统都支持多进程，为了让操作系统同时执行多个任务，但进程是重量级的，也就是新建
一个进程会消耗CPU和内存空间等系统资源，隐藏进程的数量比较有限</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="线程"></a>线程<a aria-hidden="true" tabindex="-1" class="hash-link" href="#线程" title="Direct link to heading">#</a></h4><ul><li>为了解决上述问题就提出了线程的概念，线程就是进程内部的程序流，操作系统内部支持多进程，而每个进程
的内部又是支持多线程的，线程是轻量的，新建线程会共享所在进程的系统资源，因此目前主流的开发都是采用多线程</li><li>多线程是采用时间片轮转法来保证多个线程的并发执行，所谓并发就是指宏观并行微观串行的机制</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="线程的创建"></a>线程的创建<a aria-hidden="true" tabindex="-1" class="hash-link" href="#线程的创建" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="thread类的概念"></a>Thread类的概念<a aria-hidden="true" tabindex="-1" class="hash-link" href="#thread类的概念" title="Direct link to heading">#</a></h4><ul><li><code>java.lang.Thread</code>类代表线程，任何线程对象都是<code>Thread</code>类（子类）的实例</li><li><code>Thread</code>类是线程的模板，封装了复杂线程的开启等操作，封装了操作系统的差异性</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="创建方式"></a>创建方式<a aria-hidden="true" tabindex="-1" class="hash-link" href="#创建方式" title="Direct link to heading">#</a></h4><ul><li>自定义类继承<code>Thread</code>类并重写<code>run</code>方法， 然后创建该类的对象调用<code>start</code>方法</li><li>自定义类实现<code>Runnable</code>接口并重写<code>run</code>方法，创建该类的对象作为实参来构造<code>Thread</code>类型的对象，
然后使用<code>Thread</code>类型的对象调用<code>start</code>方法</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="相关的方法"></a>相关的方法<a aria-hidden="true" tabindex="-1" class="hash-link" href="#相关的方法" title="Direct link to heading">#</a></h4><ul><li><code>Tread()</code> 无参构造</li><li><code>Tread(String name)</code> 根据参数指定的名称构造</li><li><code>Thread(Runnable target)</code> 根据参数指定的引用来构造对象</li><li><code>Thread(Runnable target, String name)</code></li><li><code>void run()</code> 若使用Runnable引用构造了线程对象，调用该方法时最终调用接口中的版本<ul><li>若没有使用Runnable引用构造线程对象，调用该方法时啥也不做</li></ul></li><li><code>void start()</code> 用于启动线程，java虚拟机会自动调用该线程的run方法</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="执行流程"></a>执行流程<a aria-hidden="true" tabindex="-1" class="hash-link" href="#执行流程" title="Direct link to heading">#</a></h3><ul><li>执行main方法的线程交主线程，执行run方法的线程叫做新线程/子线程</li><li>main方法是程序的入口，对于start方法之前的代码来说，由主线程</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="线程的生命周期"></a>线程的生命周期<a aria-hidden="true" tabindex="-1" class="hash-link" href="#线程的生命周期" title="Direct link to heading">#</a></h3><div class="mermaid">
  flowchart RL
    create((创建)) --&gt;|start|ready(就绪状态)
    subgraph  
    ready &lt;-- 调度 --&gt; run(运行状态)
    run --&gt;|导致阻塞的事件|block(阻塞状态)
    block --&gt;|阻塞解除|ready
    end
    run --&gt; stop((终止))
</div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="线程的编号和名称"></a>线程的编号和名称<a aria-hidden="true" tabindex="-1" class="hash-link" href="#线程的编号和名称" title="Direct link to heading">#</a></h3><ul><li><code>long getId()</code> 获取调用对象线程的编号</li><li><code>String getName()</code> 获取调用对象线程的名称</li><li><code>void setName(String name)</code> 设置/修改线程的名称</li><li><code>static Thread currentThread()</code> 获取当前正在执行线程的引用</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="常用方法（重点）"></a>常用方法（重点）<a aria-hidden="true" tabindex="-1" class="hash-link" href="#常用方法（重点）" title="Direct link to heading">#</a></h3><ul><li><code>static void yield()</code> 当前线程让出处理器(离开running状态)，使当前线程进入Runnable状态等待</li><li><code>static void sleep(times)</code> 使当前线程从Running放弃处理进入block状态，休眠times毫秒，再返回到Runnable，
如果其他线程打断当前线程的block(sleep)，就会发生InterruptedException</li><li><code>int getProority()</code> 获取当前线程优先级</li><li><code>void setPriority(int newPriority)</code> 修改线程优先级<ul><li>优先级越高的线程不一定先执行，但该线程获取到时间片的机会更多一些</li></ul></li><li><code>void join()</code> 等待该线程终止</li><li><code>void join(long times)</code> 等待参数指定的毫秒数</li><li><code>boolean isDaemon()</code> 判断是否为守护线程<ul><li>当子线程不是守护线程时，若主线程先结束，子线程依然会继续执行，直到执行结束</li><li>当子线程是守护线程时，当主线程结束后，子线程随之结束</li></ul></li><li><code>boolean setDaemon(boolean on)</code> 用于设置线程为守护线程<ul><li>必须在线程启动之前设置</li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="线程同步机制（重点）"></a>线程同步机制（重点）<a aria-hidden="true" tabindex="-1" class="hash-link" href="#线程同步机制（重点）" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="基本概念-1"></a>基本概念<a aria-hidden="true" tabindex="-1" class="hash-link" href="#基本概念-1" title="Direct link to heading">#</a></h4><blockquote><ul><li>当多个线程同时访问一种共享资源时，可能会造成数据的覆盖等不一致性问题，
此时就需要对线程之间进行通信和协调，该机制就叫做线程同步机制</li><li>多个线程并发读写同一个临界资源时会发生线程并发安全问题</li><li>异步操作：多线程并发的操作，各自独立运行</li><li>同步操作：多线程串行的操作，先后执行的顺序</li></ul></blockquote><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="实现方式"></a>实现方式<a aria-hidden="true" tabindex="-1" class="hash-link" href="#实现方式" title="Direct link to heading">#</a></h4><blockquote><ul><li>java中使用synchronized关键字来实现同步/对象锁机制从而保证线程执行的原子性</li><li>代码格式：</li></ul><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-java codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">类类型的引用</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    编写所有需要锁定的代码</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><ul><li>使用同步方法的方式实现所有代码的锁定
直接使用synchronized关键字来修饰整个方法即可
该方式等价于：</li></ul><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-java codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="静态方法的锁定"></a>静态方法的锁定<a aria-hidden="true" tabindex="-1" class="hash-link" href="#静态方法的锁定" title="Direct link to heading">#</a></h4><p>-当我们对一个静态方法加锁：</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-java codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">funcName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><ul><li>那么该方法锁的对象是类对象，每一个类都有唯一的一个类对象，获取类对象的方式：类名.class</li><li>静态方法与非静态方法同时使用了synchronized后它们之间是非互斥关系的</li><li>原因在于：静态方法锁的是类对象，而非静态方法锁的是当前方法所属对象</li></ul></blockquote><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="注意事项"></a>注意事项<a aria-hidden="true" tabindex="-1" class="hash-link" href="#注意事项" title="Direct link to heading">#</a></h4><ul><li>多个需要同步的线程在访问同步块时，看到的应该是同一个锁对象引用</li><li>在使用同步块时，应当尽量减少同步范围以提高并发和执行效率</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="线程安全类和不安全类"></a>线程安全类和不安全类<a aria-hidden="true" tabindex="-1" class="hash-link" href="#线程安全类和不安全类" title="Direct link to heading">#</a></h3><blockquote><ul><li><code>StringBuffer</code>类是线程安全类，<code>StringBuilder</code>类不是线程安全类</li><li><code>Vector</code>类和<code>Hashtable</code>类是线程安全类，<code>ArrayList</code>类和<code>HashMap</code>类不是线程安全类</li><li>使用<code>Collections.synchronizedList()</code>和<code>Collections.synchronizedMap()</code>等方法实现安全</li></ul></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="死锁的概念"></a>死锁的概念<a aria-hidden="true" tabindex="-1" class="hash-link" href="#死锁的概念" title="Direct link to heading">#</a></h3><ul><li>线程一执行的代码：</li></ul><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-java codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span></div></div></div></div></div><ul><li>线程二执行的代码：</li></ul><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-java codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span></div></div></div></div></div><ul><li>注意：在开发中尽量减少同步资源，减少代码块的嵌套</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="使用lock（锁）实现线程同步"></a>使用Lock（锁）实现线程同步<a aria-hidden="true" tabindex="-1" class="hash-link" href="#使用lock（锁）实现线程同步" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="基本概念-2"></a>基本概念<a aria-hidden="true" tabindex="-1" class="hash-link" href="#基本概念-2" title="Direct link to heading">#</a></h4><ul><li>从java5开始提供了更强大的线程同步机制：使用显式定义的同步锁对象来实现</li><li><code>java.util.locks.Lock</code>接口是控制多个线程对共享资源进行访问的工具</li><li>该接口的主要实现类是<code>ReentrantLock</code>类，该类拥有与<code>synchronized</code>相同的并发性，
在以后的线程安全控制中，经常使用<code>ReentrantLock</code>类显式加锁和释放锁</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="常用方法"></a>常用方法<a aria-hidden="true" tabindex="-1" class="hash-link" href="#常用方法" title="Direct link to heading">#</a></h4><blockquote><ul><li><code>ReentrantLock()</code> 无参构造</li><li><code>void lock()</code> 获取锁</li><li><code>void unlock()</code> 释放锁</li></ul></blockquote><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="与synchronize方式的比较"></a>与synchronize方式的比较<a aria-hidden="true" tabindex="-1" class="hash-link" href="#与synchronize方式的比较" title="Direct link to heading">#</a></h4><blockquote><ul><li><code>Lock</code>是显式锁，需要手动开启和关闭，而<code>synchronized</code>是隐式锁，执行锁定后代码自动释放</li><li><code>Lock</code>只有同步代码块方式的锁，而<code>synchronized</code>有同步代码块方式和同步方法两种锁</li><li>使用<code>Lock</code>锁方式时，JVM将花费较少的时间来调度线程，隐藏性能更好</li></ul></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="object类常用的方法"></a>Object类常用的方法<a aria-hidden="true" tabindex="-1" class="hash-link" href="#object类常用的方法" title="Direct link to heading">#</a></h3><blockquote><p>线程之间通信的实现</p><ul><li><code>void wait()</code> 用于使得线程进入等待状态，知道其它线程调用<code>notify()</code> 或 <code>notifyAll()</code></li><li><code>void wait(long timeout)</code> 用于进入等待状态，知道其它线程调用方法或参数指定的毫秒数已经过去为止</li><li><code>void notify()</code> 唤醒等待的单个线程</li><li><code>void notifyAll()</code> 唤醒等待的所有线程</li></ul></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="线程池"></a>线程池<a aria-hidden="true" tabindex="-1" class="hash-link" href="#线程池" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="实现callable接口"></a>实现Callable接口<a aria-hidden="true" tabindex="-1" class="hash-link" href="#实现callable接口" title="Direct link to heading">#</a></h4><ul><li>从java5开始新增加创建线程的第三种方式为实现<code>java.util.concurrent.Callable</code>接口</li><li><code>V call()</code> 计算结果并返回</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="futuretask类"></a>FutureTask类<a aria-hidden="true" tabindex="-1" class="hash-link" href="#futuretask类" title="Direct link to heading">#</a></h4><ul><li><code>java.util.FutureTask</code>类用于描述可取消的异步计算，该类提供了Futere接口的基本实现，
包括启动和取消计算、查询计算是否完成以及检索计算结果的方法，也可以用于获取方法调用后的返回结果</li><li><code>FutereTask(Callable&lt;V&gt; callable)</code> 根据参数指定的引用创建一个子任务</li><li><code>V get()</code> 获取call方法计算的结果</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="线程池概念和原理"></a>线程池概念和原理<a aria-hidden="true" tabindex="-1" class="hash-link" href="#线程池概念和原理" title="Direct link to heading">#</a></h4><blockquote><ul><li>概念：首先创建一些线程，它们的集合成为线程池，当服务器接受到一个客户请求后，
就从线程池中取出一个空闲的线程为之服务，服务完后不关闭该线程，而是将线程池还回到线程池中</li><li>在线程池变成的模式下，任务是提交给整个线程池，再把任务交给内部某个空闲的线程，
任务是提交给整个线程池，一个线程同时只能执行一个任务，但可以同时向一个线程池提交多个方法</li></ul></blockquote><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="相关类和方法"></a>相关类和方法<a aria-hidden="true" tabindex="-1" class="hash-link" href="#相关类和方法" title="Direct link to heading">#</a></h4><blockquote><ul><li>从java5开始提供了线程池的相关类和接口：<ul><li><code>java.util.concurrent.Executors</code>类</li><li><code>java.util.concurrent.ExecutorService</code>接口</li></ul></li><li>其中Executors是个工具类和线程池的工厂类，可以创建并返回不同类型的线程池<ul><li><code>static ExecutorService newCachedThreadPool()</code> 创建一个可根据需要创建新线程的线程池</li><li><code>static ExecutorService newFixedThreadPool(int n)</code> 创建固定数量的线程池</li><li><code>static ExecutorService newSingleThreadExecutor()</code> 创建只有一个线程的线程池</li></ul></li><li>其中ExecutorService接口是真正的线程池接口，主要实现类是ThreadPoolExecutor<ul><li><code>void execute(Runnable command)</code> 执行任务和命令，通常用于执行Runnable</li><li><code>&lt;T&gt;Future&lt;T&gt; submit(Callable&lt;T&gt; task)</code> 执行任务和命令，通常用于执行Callable</li><li><code>void shutdown()</code> 启动有序关闭</li></ul></li></ul></blockquote></div></article><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/notes/java/oop/core/io"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« IO流</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/notes/java/oop/core/network"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">网络编程 »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#多线程" class="table-of-contents__link">多线程</a><ul><li><a href="#基本概念" class="table-of-contents__link">基本概念</a></li><li><a href="#线程的创建" class="table-of-contents__link">线程的创建</a></li><li><a href="#执行流程" class="table-of-contents__link">执行流程</a></li><li><a href="#线程的生命周期" class="table-of-contents__link">线程的生命周期</a></li><li><a href="#线程的编号和名称" class="table-of-contents__link">线程的编号和名称</a></li><li><a href="#常用方法（重点）" class="table-of-contents__link">常用方法（重点）</a></li><li><a href="#线程同步机制（重点）" class="table-of-contents__link">线程同步机制（重点）</a></li><li><a href="#线程安全类和不安全类" class="table-of-contents__link">线程安全类和不安全类</a></li><li><a href="#死锁的概念" class="table-of-contents__link">死锁的概念</a></li><li><a href="#使用lock（锁）实现线程同步" class="table-of-contents__link">使用Lock（锁）实现线程同步</a></li><li><a href="#object类常用的方法" class="table-of-contents__link">Object类常用的方法</a></li><li><a href="#线程池" class="table-of-contents__link">线程池</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Style Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/doc2/">Second Doc</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.8856dc76.js"></script>
<script src="/runtime~main.3d7433c3.js"></script>
<script src="/main.358b5d49.js"></script>
<script src="/1.2ebb2427.js"></script>
<script src="/2.788804a9.js"></script>
<script src="/4.ef71900f.js"></script>
<script src="/1be78505.fcf222eb.js"></script>
<script src="/54.005b5dfa.js"></script>
<script src="/ec1ed54d.1373f991.js"></script>
<script src="/3.e8253ddf.js"></script>
<script src="/e98647ac.3303959e.js"></script>
</body>
</html>